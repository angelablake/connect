<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title id="page-title">Loading...</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="bio-container">
    <header class="profile-header">
      <img id="profile-image" alt="" class="profile-image" />
      <h1 id="profile-name"></h1>
      <p id="profile-tagline" class="tagline"></p>
      <div class="social-icons">
        <a id="x-link" class="social-icon" aria-label="X (Twitter)">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 512 512">
            <path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/>
          </svg>
        </a>
        <a id="linkedin-link" class="social-icon" aria-label="LinkedIn">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 448 512">
            <path fill="currentColor" d="M100.3 448H7.4V148.9h92.9zM53.8 108.1C24.1 108.1 0 83.5 0 53.8S24.1 0 53.8 0s53.8 24.1 53.8 53.8-24.1 54.3-53.8 54.3zM447.9 448h-92.7V302.4c0-34.7-.7-79.2-48.3-79.2-48.3 0-55.7 37.7-55.7 76.7V448h-92.8V148.9h89.1v40.8h1.3c12.4-23.5 42.7-48.3 87.9-48.3 94 0 111.3 61.9 111.3 142.3V448z"/>
          </svg>
        </a>
        <a id="email-link" class="social-icon" aria-label="Email">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 512 512">
            <path fill="currentColor" d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4L236.8 313.6c11.4 8.5 27 8.5 38.4 0L492.8 150.4c12.1-9.1 19.2-23.3 19.2-38.4c0-26.5-21.5-48-48-48H48zM0 176V384c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V176L294.4 339.2c-22.8 17.1-54 17.1-76.8 0L0 176z"/>
          </svg>
        </a>
      </div>
    </header>

    <section id="link-section" class="link-section">
      <!-- Links will be dynamically inserted here -->
    </section>

    <section class="bio">
      <p id="bio-text"></p>
    </section>

    <section class="blog-section">
      <h2>Latest from my Blog</h2>
      <div class="blog-post">
        <div class="post-content">
          <p>Loading latest post...</p>
        </div>
      </div>
    </section>

    <footer class="footer">
      <a id="support-button" href="#" class="support-button"></a>
    </footer>
  </main>

  <script>
    // Function to generate MD5 hash for Gravatar
    async function md5(message) {
      const msgBuffer = new TextEncoder().encode(message);
      const hashBuffer = await crypto.subtle.digest('MD5', msgBuffer);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
      return hashHex;
    }

    // Load and apply configuration
    async function initializeContent() {
      try {
        const response = await fetch('config.json');
        const config = await response.json();

        // Set page title
        document.title = config.profile.name;
        
        // Set profile information
        document.getElementById('profile-name').textContent = config.profile.name;
        document.getElementById('profile-tagline').textContent = config.profile.tagline;
        document.getElementById('bio-text').textContent = config.profile.bio;

        // Set Gravatar
        const hash = await md5(config.profile.gravatarEmail.trim().toLowerCase());
        document.getElementById('profile-image').src = `https://www.gravatar.com/avatar/${hash}?s=300`;
        document.getElementById('profile-image').alt = config.profile.name;

        // Set social links
        document.getElementById('x-link').href = config.social.x;
        document.getElementById('linkedin-link').href = config.social.linkedin;
        document.getElementById('email-link').href = `mailto:${config.social.email}`;

        // Generate link buttons
        const linkSection = document.getElementById('link-section');
        config.links.forEach(link => {
          const a = document.createElement('a');
          a.href = link.url;
          a.className = 'link-button';
          a.textContent = link.title;
          linkSection.appendChild(a);
        });

        // Set support button
        const supportBtn = document.getElementById('support-button');
        supportBtn.href = config.support.url;
        supportBtn.textContent = config.support.buttonText;

        // Load blog post
        fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(config.blog.rssFeed)}`)
          .then(response => response.json())
          .then(data => {
            const post = data.items[0];
            document.querySelector('.post-content').innerHTML = `
              <h3>${post.title}</h3>
              <p>${post.description.split(' ').slice(0, config.blog.wordCount).join(' ')}...</p>
              <a href="${post.link}" class="read-more">Read More â†’</a>
            `;
          })
          .catch(error => {
            console.error('Error fetching blog post:', error);
            document.querySelector('.post-content').innerHTML = `
              <p>Visit my blog at <a href="${config.blog.rssFeed.split('/feed')[0]}">mattcromwell.com</a></p>
            `;
          });

      } catch (error) {
        console.error('Error loading configuration:', error);
      }
    }

    // Initialize the page
    initializeContent();
  </script>
</body>
</html>
